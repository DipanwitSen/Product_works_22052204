{% extends 'base.html' %} {% block content %}
<div class="container">
  <a href="{{ url_for('admin') }}" class="btn back-btn">
    <i class="fa fa-arrow-left"></i> Back to Admin
  </a>
  <h2>Answered Chatbot Questions</h2>

  <div class="add-question-section">
    <h3>Add a New Q&A</h3>
    <form action="{{ url_for('add_new_question') }}" method="post">
      <div class="form-group">
        <label for="question">Question:</label>
        <input
          type="text"
          class="form-control"
          id="question"
          name="question"
          required
        />
      </div>
      <div class="form-group">
        <label for="answer">Answer:</label>
        <textarea
          class="form-control"
          id="answer"
          name="answer"
          rows="3"
          required
        ></textarea>
        <small class="form-text text-muted">
          For dynamic answers, use placeholders like `PRODUCT_LIST`,
          `ORDER_STATUS`, `STOCK_LEVELS`. For example: `The following products
          are available: PRODUCT_LIST`
        </small>
      </div>
      <div class="form-group">
        <label for="sql_query">
          <input type="checkbox" id="is_dynamic" onchange="toggleSqlInput()" />
          Is this a dynamic answer?
        </label>
      </div>
      <div class="form-group" id="sql_query_container" style="display: none">
        <label for="sql_query">SQL Query:</label>
        <input
          type="text"
          class="form-control"
          id="sql_query"
          name="sql_query"
        />
        <small class="form-text text-muted"
          >Use `%s` as a placeholder for the keyword from the question.</small
        >
      </div>
      <button type="submit" class="btn btn-primary">Add Q&A</button>
    </form>
  </div>
  --- {% if questions %}
  <div style="text-align: right; margin-bottom: 10px">
    <form
      action="{{ url_for('delete_all_answered_questions') }}"
      method="post"
      onsubmit="return confirm('Are you sure you want to delete ALL answered questions? This cannot be undone.');"
    >
      <button type="submit" class="btn btn-danger">Delete All</button>
    </form>
  </div>
  <table>
    <thead>
      <tr>
        <th>Question</th>
        <th>Answer</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for q in questions %}
      <tr>
        <td>{{ q['question'] }}</td>
        <td>{{ q['answer'] }}</td>
        <td>
          <form
            action="{{ url_for('delete_answered_question', question_id=q['id']) }}"
            method="post"
            onsubmit="return confirm('Are you sure you want to delete this answered question?');"
          >
            <button type="submit" class="btn btn-danger">Delete</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p>No answered questions found.</p>
  {% endif %}
</div>
<script>
  function toggleSqlInput() {
    var checkbox = document.getElementById("is_dynamic");
    var sqlContainer = document.getElementById("sql_query_container");
    sqlContainer.style.display = checkbox.checked ? "block" : "none";
  }
</script>
{% endblock %}
